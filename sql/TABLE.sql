-- 1. Admins
CREATE TABLE admins (
	id bigserial NOT NULL,
	email varchar(255) NOT NULL,
	password_hash varchar(255) NOT NULL,
	CONSTRAINT admins_email_key UNIQUE (email),
	CONSTRAINT admins_pkey PRIMARY KEY (id)
);

-- 2. Categorie_age
CREATE TABLE categorie_age (
	id int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	"label" varchar(255) NOT NULL,
	CONSTRAINT categorie_age_pkey PRIMARY KEY (id)
);

-- 3. Cities
CREATE TABLE cities (
	id serial4 NOT NULL,
	city_name varchar(100) NOT NULL,
	country varchar(100) NOT NULL,
	CONSTRAINT cities_city_name_country_key UNIQUE (city_name, country),
	CONSTRAINT cities_pkey PRIMARY KEY (id)
);

-- 4. Clients
CREATE TABLE clients (
	id serial4 NOT NULL,
	"name" varchar(255) NOT NULL,
	email varchar(255) NOT NULL,
	password_hash varchar(255) NOT NULL,
	passport_image varchar(255) NULL,
	CONSTRAINT clients_email_key UNIQUE (email),
	CONSTRAINT clients_pkey PRIMARY KEY (id)
);

-- 5. Planes
CREATE TABLE planes (
	id serial4 NOT NULL,
	model_name varchar(100) NOT NULL,
	fabrication_date date NOT NULL,
	CONSTRAINT planes_pkey PRIMARY KEY (id)
);

-- 6. Flights (depends on cities, planes)
CREATE TABLE flights (
	id serial4 NOT NULL,
	flight_number varchar(20) NOT NULL,
	id_plane int4 NULL,
	id_origin_city int4 NULL,
	id_destination_city int4 NULL,
	departure_time timestamptz NOT NULL,
	arrival_time timestamptz NOT NULL,
	reservation_deadline_hours int4 DEFAULT 3 NOT NULL,
	cancellation_deadline_hours int4 DEFAULT 24 NOT NULL,
	CONSTRAINT flights_cancellation_deadline_hours_check CHECK ((cancellation_deadline_hours >= 0)),
	CONSTRAINT flights_check CHECK ((id_origin_city <> id_destination_city)),
	CONSTRAINT flights_check1 CHECK ((arrival_time > departure_time)),
	CONSTRAINT flights_flight_number_key UNIQUE (flight_number),
	CONSTRAINT flights_pkey PRIMARY KEY (id),
	CONSTRAINT flights_reservation_deadline_hours_check CHECK ((reservation_deadline_hours >= 0)),
	CONSTRAINT flights_id_destination_city_fkey FOREIGN KEY (id_destination_city) REFERENCES cities(id) ON DELETE RESTRICT,
	CONSTRAINT flights_id_origin_city_fkey FOREIGN KEY (id_origin_city) REFERENCES cities(id) ON DELETE RESTRICT,
	CONSTRAINT flights_id_plane_fkey FOREIGN KEY (id_plane) REFERENCES planes(id) ON DELETE RESTRICT
);

-- 7. Seat_configurations (depends on planes)
CREATE TABLE seat_configurations (
	id serial4 NOT NULL,
	id_plane int4 NULL,
	category varchar(255) NULL,
	number_of_seats int4 NOT NULL,
	CONSTRAINT seat_configurations_id_plane_category_key UNIQUE (id_plane, category),
	CONSTRAINT seat_configurations_number_of_seats_check CHECK ((number_of_seats > 0)),
	CONSTRAINT seat_configurations_pkey PRIMARY KEY (id),
	CONSTRAINT seat_configurations_id_plane_fkey FOREIGN KEY (id_plane) REFERENCES planes(id) ON DELETE CASCADE
);

-- 8. Flight_reservation (depends on flights)
CREATE TABLE flight_reservation (
	id serial4 NOT NULL,
	id_flight int4 NULL,
	reservation_hour_allowed int4 NOT NULL,
	annulation_hour_allowed int4 NOT NULL,
	CONSTRAINT flight_reservation_pkey PRIMARY KEY (id),
	CONSTRAINT flight_reservation_id_flight_fkey FOREIGN KEY (id_flight) REFERENCES flights(id) ON DELETE RESTRICT
);

-- 9. Flight_prices (depends on flights)
CREATE TABLE flight_prices (
	id serial4 NOT NULL,
	id_flight int4 NULL,
	category varchar(255) NULL,
	base_price numeric(10, 2) NOT NULL,
	CONSTRAINT flight_prices_base_price_check CHECK ((base_price > (0)::numeric)),
	CONSTRAINT flight_prices_id_flight_category_key UNIQUE (id_flight, category),
	CONSTRAINT flight_prices_pkey PRIMARY KEY (id),
	CONSTRAINT flight_prices_id_flight_fkey FOREIGN KEY (id_flight) REFERENCES flights(id) ON DELETE CASCADE
);

-- 10. Flight_promotions (depends on flights)
CREATE TABLE flight_promotions (
	id serial4 NOT NULL,
	id_flight int4 NULL,
	category varchar(255) NULL,
	discount_percentage numeric(5, 2) NOT NULL,
	seats_available int4 NOT NULL,
	CONSTRAINT flight_promotions_discount_percentage_check CHECK (((discount_percentage > (0)::numeric) AND (discount_percentage <= (100)::numeric))),
	CONSTRAINT flight_promotions_id_flight_category_key UNIQUE (id_flight, category),
	CONSTRAINT flight_promotions_pkey PRIMARY KEY (id),
	CONSTRAINT flight_promotions_seats_available_check CHECK ((seats_available > 0)),
	CONSTRAINT flight_promotions_id_flight_fkey FOREIGN KEY (id_flight) REFERENCES flights(id) ON DELETE CASCADE
);

-- 11. Percentage_discount (depends on categorie_age)
CREATE TABLE percentage_discount (
	id int4 GENERATED BY DEFAULT AS IDENTITY( INCREMENT BY 1 MINVALUE 1 MAXVALUE 2147483647 START 1 CACHE 1 NO CYCLE) NOT NULL,
	age_max int4 NOT NULL,
	id_categorie_age int4 NOT NULL,
	percentage_discount float8 NULL,
	CONSTRAINT percentage_discount_pkey PRIMARY KEY (id),
	CONSTRAINT fk1i3lcfu91vltj6epmb3q35x25 FOREIGN KEY (id_categorie_age) REFERENCES categorie_age(id)
);

-- 12. Reservations (depends on clients, flights)
CREATE TABLE reservations (
	id serial4 NOT NULL,
	id_client int4 NULL,
	id_flight int4 NULL,
	reservation_time timestamptz DEFAULT CURRENT_TIMESTAMP NULL,
	nbr_billet_total int4 NOT NULL,
	nbr_billet_enfant int4 NOT NULL,
	nbr_billet_adulte int4 NOT NULL,
	CONSTRAINT reservations_pkey PRIMARY KEY (id),
	CONSTRAINT reservations_id_client_fkey FOREIGN KEY (id_client) REFERENCES clients(id) ON DELETE RESTRICT,
	CONSTRAINT reservations_id_flight_fkey FOREIGN KEY (id_flight) REFERENCES flights(id) ON DELETE RESTRICT
);

-- 13. Reservations_details (depends on reservations)
CREATE TABLE reservations_details (
	id serial4 NOT NULL,
	id_reservation int4 NOT NULL,
	seat_category varchar(255) NOT NULL,
	name_voyageur varchar(255) NOT NULL,
	dtn_voyageur date NOT NULL,
	passport_image varchar(255) NOT NULL,
	price numeric(38, 2) NOT NULL,
	is_promotional bool NOT NULL,
	is_cancel bool NOT NULL,
	cancellation_time timestamptz NULL,
	CONSTRAINT reservations_details_pkey PRIMARY KEY (id),
	CONSTRAINT reservations_details_id_reservation_fkey FOREIGN KEY (id_reservation) REFERENCES reservations(id) ON DELETE RESTRICT
);


INSERT INTO admins
(id, email, password_hash)
VALUES(1, 'admin@gmail.com', 'admin');

INSERT INTO categorie_age
(id, "label")
VALUES(1, 'Child');
INSERT INTO categorie_age
(id, "label")
VALUES(2, 'Ado');
INSERT INTO categorie_age
(id, "label")
VALUES(3, 'Adulte');


INSERT INTO cities
(id, city_name, country)
VALUES(1, 'New York', 'USA');
INSERT INTO cities
(id, city_name, country)
VALUES(2, 'London', 'United Kingdom');
INSERT INTO cities
(id, city_name, country)
VALUES(3, 'Paris', 'France');
INSERT INTO cities
(id, city_name, country)
VALUES(4, 'Tokyo', 'Japan');
INSERT INTO cities
(id, city_name, country)
VALUES(5, 'Sydney', 'Australia');
INSERT INTO cities
(id, city_name, country)
VALUES(6, 'Beijing', 'China');
INSERT INTO cities
(id, city_name, country)
VALUES(7, 'Mumbai', 'India');
INSERT INTO cities
(id, city_name, country)
VALUES(8, 'Cairo', 'Egypt');
INSERT INTO cities
(id, city_name, country)
VALUES(9, 'SÃ£o Paulo', 'Brazil');
INSERT INTO cities
(id, city_name, country)
VALUES(10, 'Moscow', 'Russia');

INSERT INTO clients
(id, "name", email, password_hash, passport_image)
VALUES(1, 'Client 1', 'client1@gmail.com', 'client1', NULL);
INSERT INTO clients
(id, "name", email, password_hash, passport_image)
VALUES(2, 'Client 2', 'client2@gmail.com', 'client2', NULL);
INSERT INTO clients
(id, "name", email, password_hash, passport_image)
VALUES(3, 'Client 3', 'client3@gmail.com', 'client3', NULL);
INSERT INTO clients
(id, "name", email, password_hash, passport_image)
VALUES(4, 'Client 4', 'client4@gmail.com', 'client4', NULL);

INSERT INTO planes
(id, model_name, fabrication_date)
VALUES(1, 'Boeing 513', '2010-01-01');
INSERT INTO planes
(id, model_name, fabrication_date)
VALUES(2, 'Airbus A320', '2015-06-01');
INSERT INTO planes
(id, model_name, fabrication_date)
VALUES(3, 'Boeing 787 Dreamliner', '2012-03-15');
INSERT INTO planes
(id, model_name, fabrication_date)
VALUES(4, 'Bombardier CRJ900', '2008-09-20');
INSERT INTO planes
(id, model_name, fabrication_date)
VALUES(5, 'Embraer ERJ145', '2006-11-10');

INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(1, 1, 'Economy', 75);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(2, 1, 'Business', 45);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(3, 1, 'First Class', 25);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(4, 2, 'Economy', 100);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(5, 2, 'Business', 50);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(6, 2, 'First Class', 30);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(7, 3, 'Economy', 100);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(8, 3, 'Business', 50);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(9, 3, 'First Class', 30);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(10, 4, 'Economy', 100);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(11, 4, 'Business', 50);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(12, 4, 'First Class', 30);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(13, 5, 'Economy', 100);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(14, 5, 'Business', 50);
INSERT INTO seat_configurations
(id, id_plane, category, number_of_seats)
VALUES(15, 5, 'First Class', 30);

INSERT INTO flights
(id, flight_number, id_plane, id_origin_city, id_destination_city, departure_time, arrival_time, reservation_deadline_hours, cancellation_deadline_hours)
VALUES(1, 'FL1001', 1, 1, 2, '2025-08-10 11:00:00.000', '2025-08-10 13:30:00.000', 3, 24);
INSERT INTO flights
(id, flight_number, id_plane, id_origin_city, id_destination_city, departure_time, arrival_time, reservation_deadline_hours, cancellation_deadline_hours)
VALUES(2, 'FL1002', 2, 2, 3, '2025-08-12 17:00:00.000', '2025-08-12 21:45:00.000', 3, 24);
INSERT INTO flights
(id, flight_number, id_plane, id_origin_city, id_destination_city, departure_time, arrival_time, reservation_deadline_hours, cancellation_deadline_hours)
VALUES(3, 'FL1003', 1, 3, 4, '2025-08-15 10:15:00.000', '2025-08-15 12:30:00.000', 4, 12);
INSERT INTO flights
(id, flight_number, id_plane, id_origin_city, id_destination_city, departure_time, arrival_time, reservation_deadline_hours, cancellation_deadline_hours)
VALUES(4, 'FL1004', 2, 4, 5, '2025-08-17 22:00:00.000', '2025-08-18 00:30:00.000', 3, 24);
INSERT INTO flights
(id, flight_number, id_plane, id_origin_city, id_destination_city, departure_time, arrival_time, reservation_deadline_hours, cancellation_deadline_hours)
VALUES(5, 'FL1005', 1, 5, 1, '2025-08-20 09:45:00.000', '2025-08-20 11:00:00.000', 2, 10);
INSERT INTO flights
(id, flight_number, id_plane, id_origin_city, id_destination_city, departure_time, arrival_time, reservation_deadline_hours, cancellation_deadline_hours)
VALUES(6, 'afe0530-5f81-406f-8', 4, 4, 9, '2025-08-05 01:00:00.000', '2025-08-05 10:00:00.000', 3, 10);